<!DOCTYPE html>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.min.js"></script>
<html lang="en">
<head th:replace="~{fragments/head::product_head}">
</head>
<body>
<div id="wrapper">
    <header th:replace="~{fragments/header::product_header}">
        <div class="top">
            <div>
                <a href="#">로그인</a>
                <a href="#">회원가입</a>
                <a href="#">마이페이지</a>
                <a href="#"><i class="fa fa-shopping-cart" aria-hidden="true"></i>&nbsp;장바구니</a>
            </div>
        </div>
        <div class="logo">
            <div>
                <a href="#"><img src="../images/header_logo.png" alt="로고" /></a>
                <form action="#">
                    <input type="text" name="search"/>
                    <button><i class="fa fa-search"></i></button>
                </form>
            </div>

        </div>
        <div class="menu">
            <div>
                <ul>
                    <li><a href="#">히트상품</a></li>
                    <li><a href="#">추천상품</a></li>
                    <li><a href="#">최신상품</a></li>
                    <li><a href="#">인기상품</a></li>
                    <li><a href="#">할인상품</a></li>
                </ul>
                <ul>
                    <li><a href="#">쿠폰존</a></li>
                    <li><a href="#">사용후기</a></li>
                    <li><a href="#">개인결제</a></li>
                    <li><a href="#">고객센터</a></li>
                    <li><a href="#">FAQ</a></li>
                </ul>
            </div>
        </div>
    </header>
    <main id="product">
        <aside th:replace="~{fragments/product/aside::product_aside}">
            <ul class="category">
                <li><i class="fa fa-bars" aria-hidden="true"></i>카테고리</li>
                <li>
                    <a href="#"><i class="fas fa-tshirt"></i>패션·의류·뷰티</a>
                    <ol>
                        <li><a href="#">남성의류</a></li>
                        <li><a href="#">여성의류</a></li>
                        <li><a href="#">잡화</a></li>
                        <li><a href="#">뷰티</a></li>
                    </ol>
                </li>
                <li>
                    <a href="#"><i class="fas fa-laptop"></i>가전·디지털</a>
                    <ol>
                        <li><a href="#">노트북/PC</a></li>
                        <li><a href="#">가전</a></li>
                        <li><a href="#">휴대폰</a></li>
                        <li><a href="#">기타</a></li>
                    </ol>
                </li>
                <li>
                    <a href="#"><i class="fas fa-utensils"></i>식품·생필품</a>
                    <ol>
                        <li><a href="#">신선식품</a></li>
                        <li><a href="#">가공식품</a></li>
                        <li><a href="#">건강식품</a></li>
                        <li><a href="#">생필품</a></li>
                    </ol>
                </li>
                <li>
                    <a href="#"><i class="fas fa-home"></i>홈·문구·취미</a>
                    <ol>
                        <li><a href="#">가구/DIY</a></li>
                        <li><a href="#">침구·커튼</a></li>
                        <li><a href="#">생활용품</a></li>
                        <li><a href="#">사무용품</a></li>
                    </ol>
                </li>
            </ul>
        </aside>

        <!-- 주문 페이지 시작-->
        <section class="order">

            <!-- 제목, 페이지 네비게이션 -->
            <nav>
                <h1>주문결제</h1>
                <p>
                    HOME > 장바구니 > <strong>주문결제</strong>
                </p>
            </nav>

            <form action="#">
                <!-- 주문 상품 목록 -->
                <table>
                    <thead>
                    <tr>
                        <th>상품명</th>
                        <th>총수량</th>
                        <th>판매가</th>
                        <th>할인율</th>
                        <th>구매금액</th>
                        <th>적립포인트</th>
                        <th>배송비</th>
                        <th>소계</th>
                    </tr>
                    </thead>
                    <tbody>
                        <th:block  th:each="orderList : ${orderLists}">
                            <tr class="orderList" >
                                <td><!--상품명-->
                                    <article>
                                        <a href="#">
                                            <img th:src="@{/api/admin/product/images/{storedName}(storedName=${orderList.thumb1})}" alt="thumb1"/>
                                        </a>
                                        <div>
                                            <h2><a href="#"><th:block th:text="${orderList.prodName}" ></th:block></a></h2>
                                            <p><th:block th:text="${orderList.descript}" ></th:block></p>
                                        </div>
                                    </article>
                                </td>
                                <td  class="count" th:text="${orderList.count}" ></td><!--총수량-->
                                <td  class="price" th:text="${orderList.price}" ></td><!--판매가-->
                                <td  class="discount" th:text="${orderList.discount}" ></td><!--할인율-->
                                <td  class="disPrice" th:text="${((orderList.price*100)-(orderList.price*orderList.discount))/100}" ></td><!--구매금액-->
                                <td  class="point" th:text="${orderList.point}" ></td><!--적립포인트-->
                                <td  class="delivery" th:text="${orderList.delivery}" ></td><!--배송비-->
                                <td  class="total" th:text="${orderList.total}" ></td><!--소계-->
                            </tr>
                        </th:block>
                    </tbody>
                </table>

                <!-- 최종 결제 정보 -->
                <div class="final">
                    <h2>최종결제 정보</h2>
                    <table border="0">
                        <tr>
                            <td>총 개수 </td>
                            <td id="orderTotalCount"> </td>
                        </tr>
                        <tr>
                            <td>상품금액</td>
                            <td id="orderTotalOriPrice" ></td>
                        </tr>
                        <tr>
                            <td>할인금액</td>
                            <td id="orderTotalDiscountPrice" ></td>
                        </tr>
                        <tr>
                            <td>배송비</td>
                            <td id="orderTotalDelivery"></td>
                        </tr>
                        <tr>
                            <td>포인트 사용금액</td>
                            <td id="usedPoint" ></td>
                        </tr>
                        <tr>
                            <td>전체주문금액</td>
                            <td id="finalOrderPrice" ></td>
                        </tr>
                    </table>
                    <input type="button" name="" value="결제하기">
                </div>

                <!-- 배송정보 -->
                <article class="delivery">
                    <h1>배송정보</h1>
                    <table>
                        <tr>
                            <td>주문자</td>
                            <td><input type="text" name="orderer" th:value="${orderUser.name}"/></td>
                        </tr>
                        <tr>
                            <td>휴대폰</td>
                            <td>
                                <input type="text" name="hp" th:value="${orderUser.hp}" />
                                <span>- 포함 입력</span>
                            </td>
                        </tr>
                        <tr>
                            <td>우편번호</td>
                            <td>
                                <input type="text" name="zip" th:value="${orderUser.zip}" />
                                <input type="button" onclick="findAddr()" value="우편번호 찾기"><br>
                            </td>
                        </tr>
                        <tr>
                            <td>기본주소</td>
                            <td>
                                <input type="text" name="addr1" th:value="${orderUser.addr1}"  />
                            </td>
                        </tr>
                        <tr>
                            <td>상세주소</td>
                            <td>
                                <input type="text" name="addr2" th:value="${orderUser.addr2}" />
                            </td>
                        </tr>
                    </table>
                </article>

                <!-- 할인정보 -->
                <article class="discount">
                    <h1>할인정보</h1>

                    <div>
                        <p>현재 포인트 : <span th:text="${orderUser.point}"></span>점</p>
                        <label>
                            <input type="text" name="point" />점
                            <input type="button" value="적용"/>
                        </label>
                        <span>포인트 5,000점 이상이면 현금처럼 사용 가능합니다.</span>
                    </div>
                </article>

                <!-- 결제방법 -->
                <article class="payment">
                    <h1>결제방법</h1>
                    <div>
                        <span>신용카드</span>
                        <p>
                            <label><input type="radio" name="payment" value="type1"/>신용카드 결제</label>
                            <label><input type="radio" name="payment" value="type2"/>체크카드 결제</label>
                        </p>
                    </div>
                    <div>
                        <span>계좌이체</span>
                        <p>
                            <label><input type="radio" name="payment" value="type3"/>실시간 계좌이체</label>
                            <label><input type="radio" name="payment" value="type4"/>무통장 입금</label>
                        </p>
                    </div>
                    <div>
                        <span>기타</span>
                        <p>
                            <label><input type="radio" name="payment" value="type3"/>휴대폰결제</label>
                            <label>
                                <input type="radio" name="payment" value="type4"/>카카오페이
                                <img src="../images/ico_kakaopay.gif" alt="카카오페이"/>
                            </label>
                        </p>
                    </div>
                </article>

                <!-- 경고 -->
                <article class="alert">
                    <ul>
                        <li><span>롯데ON의 모든 판매자는 안전거래를 위해 구매금액, 결제수단에 상관없이 모든거래에 대하여 롯데ON 유한책임회사의 구매안전서비스(에스크로)를 제공하고 있습니다.</span></li>
                        <li><span>롯데ON 유한책임회사의 전자금융거래법에 의해 결제대금예치업 등록번호는 02-006-00008 입니다.</span></li>
                        <li><span>등록여부는 금융감독원 홈페이지(www.fss.or.kr)의 업무자료>인허가업무안내>전자금융업등록현황에서 확인하실수 있습니다.</span></li>
                    </ul>
                </article>

            </form>

        </section>
        <!-- 주문 페이지 끝-->
    </main>
    <footer th:replace="~{fragments/footer::footer}">
    </footer>
    <button type="button" id="top">상단이동</button>
</div>
</body>


<script>

    $(document).ready(function (){

     //클래스를 저장
     let orderLists = document.getElementsByClassName("orderList");//orderList클래스 정의
        console.log("orderLists :"+orderLists.length);
     let Counts =  document.getElementsByClassName("count");<!--총수량-->
     let OriPrices =  document.getElementsByClassName("price");<!--판매가-->
     let discounts =  document.getElementsByClassName("discount");<!--할인율-->
     let disPrices =  document.getElementsByClassName("disPrice");<!--구매금액-->
     let Deliveries =  document.getElementsByClassName("delivery");<!--배송비-->
     let TotalPrices =  document.getElementsByClassName("total");<!--소개-->
     //킄래스들의 값을 저장해 줄 변수 생성
     let totalCount =0 ;
     let totalOriPrice =0 ;
     let totalDisPrice =0 ;
     let totalDelivery =0 ;
     let totalPrice =0 ;
     for(var i =0; i<orderLists.length;i++){
         //클래스의 변수를 저장
         let count = parseInt(Counts[i].textContent.trim(),10);
         let oriPrice = parseInt(OriPrices[i].textContent.trim(),10)*count;
         let discount = parseInt(discounts[i].textContent.trim(),10);
         let disPrice = oriPrice*(discount/100);
         console.log("disPrice :"+disPrice);
         let delivery = parseInt(Deliveries[i].textContent.trim(),10);
         let price = parseInt(TotalPrices[i].textContent.trim(),10);
         totalCount+=count;
         totalOriPrice+=oriPrice;
         totalDisPrice+=disPrice;
         totalDelivery+=delivery;
         totalPrice+=price;
     }
        console.log("totalCount :"+totalCount);
        console.log("totalOriPrice :"+totalOriPrice);
        console.log("totalDisPrice :"+totalDisPrice);
        console.log("totalDelivery :"+totalDelivery);
        console.log("totalPrice :"+totalPrice);


        $("#orderTotalCount").text(totalCount+"개");<!--총 개수-->
        $("#orderTotalOriPrice").text(totalOriPrice+"원");<!--상품금액-->
        $("#orderTotalDiscountPrice").text(totalDisPrice+"원");<!--할인금액-->
        $("#orderTotalDelivery").text(totalDelivery+"원");<!--배송비-->
        $("#usedPoint").text(0+"원");<!--사용포인트-->
        $("#finalOrderPrice").text(totalPrice+totalDelivery+"원");<!--전체주문금액-->

    });


    function findAddr() {
        new daum.Postcode({
            oncomplete: function (data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var addr = ''; // 주소 변수
                var extraAddr = ''; // 참고항목 변수

                //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    addr = data.roadAddress;
                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    addr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                if (data.userSelectedType === 'R') {
                    // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                    // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                    if (data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
                        extraAddr += data.bname;
                    }
                    // 건물명이 있고, 공동주택일 경우 추가한다.
                    if (data.buildingName !== '' && data.apartment === 'Y') {
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                    if (extraAddr !== '') {
                        extraAddr = ' (' + extraAddr + ')';
                    }
                    // 조합된 참고항목을 해당 필드에 넣는다.
                    document.getElementById("info").value = extraAddr;

                } else {
                    document.getElementById("info").value = '';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('zip').value = data.zonecode;
                document.getElementById("addr1").value = addr;
                // 커서를 상세주소 필드로 이동한다.
                document.getElementById("addr2").focus();
            }
        }).open();
    }



</script>

</html>